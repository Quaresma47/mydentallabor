<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyDentalLabor | Güvenilir Protez Çözümleri</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

 <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Özel Stil -->
  <link rel="stylesheet" href="style.css" />

  <!-- Navbar (index.html ile aynı) -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top shadow">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="images/logo.png" alt="Logo" style="height:40px; margin-right:8px;">
        <span style="font-weight:600; font-size:1.2rem;">MyDentalLabor</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="index.html">Ana Sayfa</a></li>
          <li class="nav-item"><a class="nav-link" href="hakkımızda.html">Hakkımızda</a></li>
          <li class="nav-item"><a class="nav-link" href="gallery.html">Galeri</a></li>
          <li class="nav-item"><a class="nav-link active" href="filesend.html">Dosya Gönder</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">İletişim</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Sayfa Başlığı -->
  <header class="page-hero text-center">
    <div class="container">
      <h1 class="fw-bold">Dosya Gönder</h1>
      <p class="text-muted">Hastalarınıza ait dosyaları güvenli şekilde bize iletebilirsiniz.</p>
    </div>
  </header>

  <!-- Dosya Gönderim Formu -->
  <section class="container py-5">
  <div class="row align-items-center">
    
    <!-- Sol: Form -->
    <div class="col-md-6">
      <h2 class="mb-4">Dosya Yükleme Formu</h2>
  <form id="dosyaForm" class="dosya-formu p-4 shadow-sm" enctype="multipart/form-data" novalidate>
    <input type="hidden" name="form-name" value="filesend">
        <div class="mb-3">
          <label for="name" class="form-label">Ad Soyad</label>
          <input type="text" class="form-control" id="name" placeholder="Adınızı ve soyadınızı giriniz">
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">E-posta</label>
          <input type="email" class="form-control" id="email" placeholder="ornek@mail.com" required>
          <div class="invalid-feedback">Lütfen geçerli bir e-posta adresi girin.</div>
        </div>
        <div class="mb-3">
          <label for="desc" class="form-label">Açıklama</label>
          <textarea class="form-control" id="desc" rows="3" placeholder="Dosya ile ilgili açıklama ekleyebilirsiniz..."></textarea>
        </div>
        <div class="mb-3">
          <label for="file" class="form-label">Dosya Seç</label>
          <input type="file" class="form-control" id="fileInput" multiple accept=".stl,.STL,model/stl,image/*,application/pdf">
          <small class="text-muted">Desteklenen formatlar: STL, JPG, PNG, PDF — Birden çok dosya seçebilirsiniz.</small>
        </div>

        <!-- Seçilmiş dosyaların listeleneceği alan -->
        <div class="mb-3">
          <label class="form-label">Seçilen Dosyalar</label>
          <ul id="fileList" class="list-group"></ul>
        </div>

        <div class="d-flex align-items-center">
          <button type="submit" class="btn btn-dosya">Gönder</button>
          <button id="previewBtn" type="button" class="btn btn-secondary ms-3">Önizle</button>
        </div>
      </form>
    </div>

    <!-- Sağ: Video -->
    <div class="col-md-6 text-center">
      <video autoplay muted loop playsinline class="w-100 rounded shadow">
        <source src="images/HDB.mp4" type="video/mp4">
        Tarayıcınız video etiketini desteklemiyor.
      </video>
    </div>

  </div>
</section>
  <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <!-- 1️⃣ İLETİŞİM -->
      <div class="col">
        <h5>İletişim</h5>
        <p>
          1636 Sok. 10/2 Bayraklı / İZMİR<br>
          Tel: <a href="https://wa.me/905363956464" target="_blank">
          <i class="fab fa-whatsapp"></i> WhatsApp ile iletişime geç</a><br>
          E-posta: <a href="mailto:newmydental@outlook.com">newmydental@outlook.com</a>
        </p>
      </div>

      <!-- 2️⃣ HIZLI LİNKLER -->
      <div class="col">
        <h5>Hızlı Linkler</h5>
        <ul class="list-unstyled">
          <li><a href="index.html">Ana Sayfa</a></li>
          <li><a href="hakkımızda.html">Hakkımızda</a></li>
          <li><a href="gallery.html">Galeri</a></li>
          <li><a href="contact.html">İletişim</a></li>
        </ul>
      </div>

      <!-- 4️⃣ SOSYAL MEDYA -->
       <div class="col social-links">
        <h5>Sosyal Medya</h5>
         <a href="https://www.facebook.com/" target="_blank" title="Facebook">
          <i class="fab fa-facebook-f"></i>
         </a>
         <a href="https://www.instagram.com/" target="_blank" title="Instagram">
          <i class="fab fa-instagram"></i>
         </a>
         <a href="https://www.linkedin.com/" target="_blank" title="LinkedIn">
          <i class="fab fa-linkedin-in"></i>
       </a>
      </div>
    </div>

<!-- ALT KISIM -->
<div class="footer-bottom">
  © 2025 MyDentalLabor tüm hakları saklıdır.
</div>
</div> <!-- container kapanışı -->
</footer>
  <!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.getElementById('previewBtn').addEventListener('click', () => {
  const fileInput = document.getElementById('file');
  const file = fileInput.files[0];
  if (file && file.name.endsWith('.stl')) {
    window.location.href = `/preview.html?file=${encodeURIComponent(file.name)}`;
  } else {
    alert('Lütfen STL formatında bir dosya seçin.');
  }
});
</script>
<script>
const API_BASE = "https://xch7lt656j.execute-api.eu-central-1.amazonaws.com/default";
const form = document.getElementById("dosyaForm");
const fileInput = document.getElementById("file");
const fileList = document.getElementById("fileList");
const submitBtn = form.querySelector('button[type="submit"]');

// 📂 Seçilen dosyaları listele
fileInput.addEventListener("change", () => {
  fileList.innerHTML = "";
  Array.from(fileInput.files).forEach((file) => {
    const li = document.createElement("li");
    li.className = "list-group-item";
    li.textContent = file.name;
    fileList.appendChild(li);
  });
});

// 📤 Form gönderimi
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  submitBtn.disabled = true;
  const originalText = submitBtn.textContent;
  submitBtn.textContent = "Yükleniyor...";

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const description = document.getElementById("desc").value.trim();
  const files = fileInput.files;

  if (!name || !email || files.length === 0) {
    alert("Lütfen ad, e-posta ve en az bir dosya seçin.");
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    return;
  }

  try {
    for (const file of files) {
      // 1️⃣ Lambda'dan presigned URL al
      const res = await fetch(`${API_BASE}/get-presigned`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: file.name, type: file.type }),
      });
      const { uploadURL, key } = await res.json();

      // Presigned URL ile dosyayı S3'e yükle
await fetch(uploadURL, { method: "PUT", body: file });

// ✅ Yükleme tamamlandıktan sonra önizleme sayfasına git
const fileName = encodeURIComponent(file.name);
window.location.href = `preview.html?file=${fileName}`;

      // 3️⃣ Bilgileri submit-form Lambda'ya gönder
      await fetch(`${API_BASE}/submit-form`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name,
          email,
          description,
          fileKey: key,
        }),
      });
    }

    alert("Dosyalar başarıyla yüklendi 🎉");
    form.reset();
    fileList.innerHTML = "";
  } catch (err) {
    console.error("Yükleme hatası:", err);
    alert("Bir hata oluştu, lütfen tekrar deneyin.");
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
  }
});
</script>
<!-- 🧩 Önizleme butonunun local preview kodu -->
<script>
document.getElementById("previewBtn").addEventListener("click", function() {
  const fileInput = document.getElementById("fileInput");
  if (!fileInput.files.length) {
    alert("Lütfen bir dosya seçin.");
    return;
  }

  const file = fileInput.files[0]; // sadece ilk seçilen dosya önizlenir
  const fileUrl = URL.createObjectURL(file);

  // Local URL’i tarayıcı belleğine kaydet
  sessionStorage.setItem("stlObjectUrl", fileUrl);

  // preview sayfasını yeni sekmede aç
  window.open("preview.html", "_blank");
});
</script>

<script src="test-s3.js"></script>
</body>
</html>
