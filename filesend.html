<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyDentalLabor | GÃ¼venilir Protez Ã‡Ã¶zÃ¼mleri</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

 <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Ã–zel Stil -->
  <link rel="stylesheet" href="style.css" />

  <!-- Navbar (index.html ile aynÄ±) -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top shadow">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="images/logo.png" alt="Logo" style="height:40px; margin-right:8px;">
        <span style="font-weight:600; font-size:1.2rem;">MyDentalLabor</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="index.html">Ana Sayfa</a></li>
          <li class="nav-item"><a class="nav-link" href="hakkÄ±mÄ±zda.html">HakkÄ±mÄ±zda</a></li>
          <li class="nav-item"><a class="nav-link" href="gallery.html">Galeri</a></li>
          <li class="nav-item"><a class="nav-link active" href="filesend.html">Dosya GÃ¶nder</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Ä°letiÅŸim</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Sayfa BaÅŸlÄ±ÄŸÄ± -->
  <header class="page-hero text-center">
    <div class="container">
      <h1 class="fw-bold">Dosya GÃ¶nder</h1>
      <p class="text-muted">HastalarÄ±nÄ±za ait dosyalarÄ± gÃ¼venli ÅŸekilde bize iletebilirsiniz.</p>
    </div>
  </header>

  <!-- Dosya GÃ¶nderim Formu -->
  <section class="container py-5">
  <div class="row align-items-center">
    
    <!-- Sol: Form -->
    <div class="col-md-6">
      <h2 class="mb-4">Dosya YÃ¼kleme Formu</h2>
  <form id="dosyaForm" class="dosya-formu p-4 shadow-sm" enctype="multipart/form-data" novalidate>
    <input type="hidden" name="form-name" value="filesend">
        <div class="mb-3">
          <label for="name" class="form-label">Ad Soyad</label>
          <input type="text" class="form-control" id="name" placeholder="AdÄ±nÄ±zÄ± ve soyadÄ±nÄ±zÄ± giriniz">
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">E-posta</label>
          <input type="email" class="form-control" id="email" placeholder="ornek@mail.com" required>
          <div class="invalid-feedback">LÃ¼tfen geÃ§erli bir e-posta adresi girin.</div>
        </div>
        <div class="mb-3">
          <label for="desc" class="form-label">AÃ§Ä±klama</label>
          <textarea class="form-control" id="desc" rows="3" placeholder="Dosya ile ilgili aÃ§Ä±klama ekleyebilirsiniz..."></textarea>
        </div>
        <div class="mb-3">
          <label for="file" class="form-label">Dosya SeÃ§</label>
          <input type="file" class="form-control" id="fileInput" multiple accept=".stl,.STL,model/stl,image/*,application/pdf">
          <small class="text-muted">Desteklenen formatlar: STL, JPG, PNG, PDF â€” Birden Ã§ok dosya seÃ§ebilirsiniz.</small>
        </div>

        <!-- SeÃ§ilmiÅŸ dosyalarÄ±n listeleneceÄŸi alan -->
        <div class="mb-3">
          <label class="form-label">SeÃ§ilen Dosyalar</label>
          <ul id="fileList" class="list-group"></ul>
        </div>

        <div class="d-flex align-items-center">
          <button type="submit" class="btn btn-dosya">GÃ¶nder</button>
          <button id="previewBtn" type="button" class="btn btn-secondary ms-3">Ã–nizle</button>
        </div>
      </form>
    </div>

    <!-- SaÄŸ: Video -->
    <div class="col-md-6 text-center">
      <video autoplay muted loop playsinline class="w-100 rounded shadow">
        <source src="images/HDB.mp4" type="video/mp4">
        TarayÄ±cÄ±nÄ±z video etiketini desteklemiyor.
      </video>
    </div>

  </div>
</section>
  <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <!-- 1ï¸âƒ£ Ä°LETÄ°ÅžÄ°M -->
      <div class="col">
        <h5>Ä°letiÅŸim</h5>
        <p>
          1636 Sok. 10/2 BayraklÄ± / Ä°ZMÄ°R<br>
          Tel: <a href="https://wa.me/905363956464" target="_blank">
          <i class="fab fa-whatsapp"></i> WhatsApp ile iletiÅŸime geÃ§</a><br>
          E-posta: <a href="mailto:newmydental@outlook.com">newmydental@outlook.com</a>
        </p>
      </div>

      <!-- 2ï¸âƒ£ HIZLI LÄ°NKLER -->
      <div class="col">
        <h5>HÄ±zlÄ± Linkler</h5>
        <ul class="list-unstyled">
          <li><a href="index.html">Ana Sayfa</a></li>
          <li><a href="hakkÄ±mÄ±zda.html">HakkÄ±mÄ±zda</a></li>
          <li><a href="gallery.html">Galeri</a></li>
          <li><a href="contact.html">Ä°letiÅŸim</a></li>
        </ul>
      </div>

      <!-- 4ï¸âƒ£ SOSYAL MEDYA -->
       <div class="col social-links">
        <h5>Sosyal Medya</h5>
         <a href="https://www.facebook.com/" target="_blank" title="Facebook">
          <i class="fab fa-facebook-f"></i>
         </a>
         <a href="https://www.instagram.com/" target="_blank" title="Instagram">
          <i class="fab fa-instagram"></i>
         </a>
         <a href="https://www.linkedin.com/" target="_blank" title="LinkedIn">
          <i class="fab fa-linkedin-in"></i>
       </a>
      </div>
    </div>

<!-- ALT KISIM -->
<div class="footer-bottom">
  Â© 2025 MyDentalLabor tÃ¼m haklarÄ± saklÄ±dÄ±r.
</div>
</div> <!-- container kapanÄ±ÅŸÄ± -->
</footer>
  <!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.getElementById('previewBtn').addEventListener('click', () => {
  const fileInput = document.getElementById('file');
  const file = fileInput.files[0];
  if (file && file.name.endsWith('.stl')) {
    window.location.href = `/preview.html?file=${encodeURIComponent(file.name)}`;
  } else {
    alert('LÃ¼tfen STL formatÄ±nda bir dosya seÃ§in.');
  }
});
</script>
<!-- ðŸ§© Alt alta dosya listesi + Ã¶nizleme + yÃ¼kleme sistemi -->
<script>
const API_BASE = "https://xch7lt656j.execute-api.eu-central-1.amazonaws.com/prod";
const form = document.getElementById("dosyaForm");
const fileInput = document.getElementById("fileInput");
const fileList = document.getElementById("fileList");
const submitBtn = form.querySelector('button[type="submit"]');
const previewBtn = document.getElementById("previewBtn");

// ðŸ“‚ SeÃ§ilen dosyalarÄ± alt alta listele
fileInput.addEventListener("change", () => {
  fileList.innerHTML = "";
  if (!fileInput.files.length) {
    fileList.innerHTML = "<li class='list-group-item text-muted'>HenÃ¼z dosya seÃ§ilmedi.</li>";
    return;
  }

  Array.from(fileInput.files).forEach((file, index) => {
    const li = document.createElement("li");
    li.className = "list-group-item d-flex justify-content-between align-items-center";
    li.innerHTML = `
      <span>${index + 1}. ${file.name}</span>
      <button type="button" class="btn btn-sm btn-outline-primary preview-single" data-index="${index}">
        <i class="fa fa-eye"></i>
      </button>
    `;
    fileList.appendChild(li);
  });

  // Her bir dosya iÃ§in tekil Ã¶nizleme butonu
  document.querySelectorAll(".preview-single").forEach(btn => {
    btn.addEventListener("click", e => {
      const i = e.currentTarget.dataset.index;
      const file = fileInput.files[i];
      const url = URL.createObjectURL(file);
      sessionStorage.setItem("stlObjectUrl", url);
      window.open("preview.html", "_blank");
    });
  });
});

// ðŸ”§ Basit durum etiketi
function showStatus(message, color = "#0f0") {
  let el = document.getElementById("uploadStatus");
  if (!el) {
    el = document.createElement("div");
    el.id = "uploadStatus";
    el.style.position = "fixed";
    el.style.bottom = "20px";
    el.style.right = "20px";
    el.style.background = "#111";
    el.style.color = color;
    el.style.padding = "10px 16px";
    el.style.borderRadius = "8px";
    el.style.zIndex = "9999";
    document.body.appendChild(el);
  }
  el.style.color = color;
  el.textContent = message;
}

// ðŸ“¤ Form gÃ¶nderimi
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  submitBtn.disabled = true;
  const originalText = submitBtn.textContent;
  submitBtn.textContent = "YÃ¼kleniyor...";

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const description = document.getElementById("desc").value.trim();
  const files = fileInput.files;

  if (!name || !email || files.length === 0) {
    alert("LÃ¼tfen ad, e-posta ve en az bir dosya seÃ§in.");
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    return;
  }

  try {
    showStatus("ðŸ“¤ YÃ¼kleniyor...", "#ffd700");

    for (const file of files) {
      // ðŸ”¹ Presigned URL al â€” email bazlÄ± klasÃ¶rleme aktif
      const res = await fetch(`${API_BASE}/get-presigned`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ 
          name: `uploads/${email}/${file.name}`,
          type: file.type 
        }),
      });
      const { uploadURL, key } = await res.json();

      // ðŸ”¹ DosyayÄ± yÃ¼kle
      await fetch(uploadURL, { method: "PUT", body: file });

      // ðŸ”¹ Form kaydÄ±nÄ± Lambda'ya gÃ¶nder
      await fetch(`${API_BASE}/submit-form`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, description, fileKey: key }),
      });
    }

    showStatus("âœ… Dosyalar baÅŸarÄ±yla yÃ¼klendi!", "#00ff00");
    alert("Dosyalar baÅŸarÄ±yla yÃ¼klendi ðŸŽ‰");
    form.reset();
    fileList.innerHTML = "";

  } catch (err) {
    console.error("YÃ¼kleme hatasÄ±:", err);
    showStatus("âŒ YÃ¼kleme hatasÄ±!", "red");
    alert("Bir hata oluÅŸtu, lÃ¼tfen tekrar deneyin.");
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    setTimeout(() => document.getElementById("uploadStatus")?.remove(), 3000);
  }
});

// ðŸ§© TÃ¼m dosyalarÄ± sÄ±rayla Ã¶nizleme
previewBtn.addEventListener("click", () => {
  const files = fileInput.files;
  if (!files.length) {
    alert("LÃ¼tfen bir veya daha fazla dosya seÃ§in.");
    return;
  }

  Array.from(files).forEach((file) => {
    const url = URL.createObjectURL(file);
    sessionStorage.setItem("stlObjectUrl", url);
    window.open("preview.html", "_blank");
  });
});
</script>

